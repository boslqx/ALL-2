<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manager.css') }}">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
    <h2>{{ manager_name }}</h2>
     </div>
        <ul class="nav-menu">
             <li class="nav-item {% if active_tab == 'Dashboard' %}active{% endif %}" onclick="showSection('Dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </li>
            <li class="nav-item {% if active_tab == 'All Products' %}active{% endif %}" onclick="showSection('All Products')">
                <i class="fas fa-box-open"></i>
                <span>All Products</span>
            </li>
            <li class="nav-item {% if active_tab == 'Inventory Report' %}active{% endif %}" onclick="showSection('Inventory Report')">
                <i class="fas fa-chart-line"></i>
                <span>Inventory Report</span>
            </li>
            <li class="nav-item {% if active_tab == 'Sales Report' %}active{% endif %}" onclick="showSection('Sales Report')">
                <i class="fas fa-chart-line"></i>
                <span>Sales Report</span>
            </li>
            <li class="nav-item {% if active_tab == 'Employee' %}active{% endif %}" onclick="showSection('Employee')">
                <i class="fas fa-clipboard-list"></i>
                <span>Employee</span>
            </li>
            <li class="nav-item logout" onclick="showLogoutModal()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </li>
        </ul>
    </div>

    <!-- Main Content (Placeholder) -->
    <div class="main-content">
        <div id="Dashboard" class="section">Manager Dashboard</div>
        <div id="All Products" class="section" style="display:none;">Products list</div>
        <div id="Inventory Report" class="section" style="display:none;">
    <div class="activity-logs-container">
        <h2>Inventory Activity Log</h2>
        <div class="log-filters">
            <select id="log-filter">
                <option value="all">All Activities</option>
                <option value="ADD_PRODUCT">Product Additions</option>
                <option value="UPDATE_STOCK">Stock Updates</option>
            </select>
            <button id="refresh-logs">Refresh</button>
            <span id="log-status"></span>
        </div>
        <div class="log-table-container">
            <table id="activity-logs-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>User</th>
                        <th>Action</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody id="logs-body">
                    <!-- Logs will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>
        <div id="Sales Report" class="section" style="display:none;">Sales Report</div>
        <div id="Employee" class="section" style="display:none;">Manage Employees</div>
    </div>


    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="modal">
    <div class="modal-content">
        <p>Are you sure you want to log out?</p>
        <div class="modal-buttons">
        <button id="cancelLogout" class="cancel-btn">No</button>
        <a href="{{ url_for('login.logout') }}" class="confirm-btn">Log Out</a>
        </div>
    </div>
    </div>




    <script>
    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(el => el.style.display = 'none');

        // Show selected section
        document.getElementById(sectionId).style.display = 'block';

        // Update active class on sidebar
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', function () {
        const logoutBtn = document.querySelector('.logout');
        const logoutModal = document.getElementById('logoutModal');
        const cancelLogout = document.getElementById('cancelLogout');

        if (logoutBtn && logoutModal && cancelLogout) {
            logoutBtn.addEventListener('click', () => {
                logoutModal.style.display = 'flex';
            });

            cancelLogout.addEventListener('click', () => {
                logoutModal.style.display = 'none';
            });
        }
    });
    </script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Load logs when Inventory Report section is shown
    const inventoryNavItem = document.querySelector('.nav-item[onclick*="Inventory Report"]');
    if (inventoryNavItem) {
        inventoryNavItem.addEventListener('click', loadActivityLogs);
    }

    // Refresh button
    const refreshBtn = document.getElementById('refresh-logs');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', loadActivityLogs);
    }

    async function loadActivityLogs() {
        try {
            const statusElement = document.getElementById('log-status');
            const tbody = document.getElementById('logs-body');

            // Show loading state
            if (statusElement) statusElement.textContent = 'Loading...';
            if (tbody) tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading logs...</td></tr>';

            const filter = document.getElementById('log-filter').value;
            const url = filter === 'all'
    ? '/manager/activity-logs'
    : `/manager/activity-logs?action=${filter}`;
const response = await fetch(url);


            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const logs = await response.json();

            if (logs.error) {
                throw new Error(logs.error);
            }

            renderLogs(logs);
            if (statusElement) statusElement.textContent = '';

        } catch (error) {
            console.error('Error loading logs:', error);
            const errorElement = document.createElement('div');
            errorElement.textContent = `Failed to load logs: ${error.message}`;
            errorElement.style.color = 'red';
            errorElement.style.padding = '20px';
            errorElement.style.textAlign = 'center';

            const tbody = document.getElementById('logs-body');
            if (tbody) {
                tbody.innerHTML = '';
                tbody.appendChild(document.createElement('tr')).appendChild(errorElement);
            }

            const statusElement = document.getElementById('log-status');
            if (statusElement) statusElement.textContent = 'Error loading logs';
        }
    }

    function renderLogs(logs) {
        const tbody = document.getElementById('logs-body');
        if (!tbody) return;

        tbody.innerHTML = '';

        if (logs.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `<td colspan="4" style="text-align: center;">No activity logs found</td>`;
            tbody.appendChild(row);
            return;
        }

        logs.forEach(log => {
            const row = document.createElement('tr');
            // Format timestamp if needed
            const timestamp = new Date(log.Timestamp).toLocaleString();
            row.innerHTML = `
                <td>${timestamp}</td>
                <td>${log.UserName || 'System'}</td>
                <td>${formatActionType(log.ActionType)}</td>
                <td>${log.Description || 'No description'}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function formatActionType(action) {
        const actions = {
            'ADD_PRODUCT': 'Add Product',
            'UPDATE_STOCK': 'Update Stock',
            // Add more action types as needed
        };
        return actions[action] || action;
    }
});
</script>


</body>
</html>
